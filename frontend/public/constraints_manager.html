<!DOCTYPE html>
<html lang="fr" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéØ Gestionnaire de Contraintes - School Scheduler</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #ffffff;
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .header h1 {
            color: #4a5568;
            margin-bottom: 10px;
            font-size: 2.2em;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .stat-card {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .controls {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .btn-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 14px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-danger {
            background: linear-gradient(45deg, #e53e3e, #c53030);
            color: white;
        }

        .btn-success {
            background: linear-gradient(45deg, #38a169, #2f855a);
            color: white;
        }

        .btn-primary {
            background: linear-gradient(45deg, #4299e1, #3182ce);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(45deg, #ed8936, #dd8936);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.2);
        }

        .constraints-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 25px;
            margin-bottom: 25px;
        }

        .constraint-panel {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .constraint-panel h3 {
            color: #4a5568;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .constraint-item {
            background: #f7fafc;
            border-left: 4px solid #4299e1;
            padding: 15px;
            margin-bottom: 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .constraint-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .constraint-item.inactive {
            opacity: 0.6;
            border-left-color: #cbd5e0;
        }

        .constraint-item.hard {
            border-left-color: #e53e3e;
            background: #fed7d7;
        }

        .constraint-item.strong {
            border-left-color: #ed8936;
            background: #feebc8;
        }

        .constraint-item.medium {
            border-left-color: #ecc94b;
            background: #fefcbf;
        }

        .constraint-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }

        .constraint-name {
            font-weight: 600;
            color: #2d3748;
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            color: white;
        }

        .priority-0 { background: #e53e3e; }
        .priority-1 { background: #ed8936; }
        .priority-2 { background: #ecc94b; color: #744210; }
        .priority-3 { background: #4299e1; }
        .priority-4 { background: #38a169; }
        .priority-5 { background: #805ad5; }

        .constraint-description {
            color: #718096;
            font-size: 14px;
            margin-bottom: 10px;
        }

        .constraint-controls {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
            border-radius: 6px;
        }

        .add-constraint-form {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #4a5568;
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }

        .hebrew-support {
            direction: rtl;
            text-align: right;
        }

        .status-message {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .status-success {
            background: #c6f6d5;
            color: #22543d;
            border: 1px solid #9ae6b4;
        }

        .status-error {
            background: #fed7d7;
            color: #742a2a;
            border: 1px solid #feb2b2;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .constraints-section {
                grid-template-columns: 1fr;
            }
            
            .btn-group {
                flex-direction: column;
            }
        }

        /* Nouveaux styles pour les notifications */
        .status-warning {
            background: #fed7aa;
            color: #c05621;
            border-left: 4px solid #ed8936;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        /* Styles pour les notifications fixes */
        .schedule-update-notification,
        .regeneration-suggestion {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.4;
        }

        .schedule-update-notification button:hover,
        .regeneration-suggestion button:hover {
            opacity: 0.8;
            transform: translateY(-1px);
            transition: all 0.2s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Gestionnaire de Contraintes</h1>
            <p>Visualisez, modifiez et g√©rez toutes les contraintes d'emploi du temps</p>
            
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-number" id="totalConstraints">0</div>
                    <div>Total Contraintes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="activeConstraints">0</div>
                    <div>Actives</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="hardConstraints">0</div>
                    <div>HARD (Critiques)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number" id="userConstraints">0</div>
                    <div>Utilisateur</div>
                </div>
            </div>
        </div>
        
        <div class="controls">
            <h3>üîß Actions Rapides</h3>
            <div class="btn-group">
                <button class="btn btn-primary" onclick="loadConstraints()">
                    üîÑ Rafra√Æchir
                </button>
                <button class="btn btn-danger" onclick="resetAllConstraints()">
                    üßπ Tout Nettoyer
                </button>
                <button class="btn btn-warning" onclick="disableAllSoft()">
                    ‚ö†Ô∏è D√©sactiver Soft
                </button>
                <button class="btn btn-success" onclick="testSolver()">
                    ‚ö° Tester Solver
                </button>
            </div>
            
            <div id="statusMessage"></div>
        </div>

        <div class="constraints-section">
            <div class="constraint-panel">
                <h3>üèõÔ∏è Contraintes Institutionnelles</h3>
                <div id="institutionalConstraints">
                    <div class="loading"></div> Chargement...
                </div>
            </div>

            <div class="constraint-panel">
                <h3>üë§ Contraintes Utilisateur</h3>
                <div id="userConstraintsList">
                    <div class="loading"></div> Chargement...
                </div>
            </div>
        </div>

        <div class="add-constraint-form">
            <h3>‚ûï Ajouter une Nouvelle Contrainte</h3>
            <form id="constraintForm">
                <div class="form-group">
                    <label for="constraintText">Description en langage naturel:</label>
                    <textarea id="constraintText" rows="3" 
                              placeholder="Ex: Le professeur Cohen n'est pas disponible le vendredi apr√®s-midi"
                              class="hebrew-support"></textarea>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                    <div class="form-group">
                        <label for="constraintType">Type:</label>
                        <select id="constraintType">
                            <option value="teacher_availability">Disponibilit√© Prof</option>
                            <option value="class_constraint">Contrainte Classe</option>
                            <option value="subject_timing">Horaire Mati√®re</option>
                            <option value="room_usage">Utilisation Salle</option>
                            <option value="custom">Personnalis√©</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label for="entityName">Professeur/Classe:</label>
                        <input type="text" id="entityName" 
                               placeholder="Ex: Cohen, 9A, Salle 101"
                               class="hebrew-support">
                    </div>
                    
                    <div class="form-group">
                        <label for="priority">Priorit√©:</label>
                        <select id="priority">
                            <option value="0">üî¥ HARD - Critique</option>
                            <option value="1">üü† Tr√®s Forte</option>
                            <option value="2" selected>üü° Moyenne</option>
                            <option value="3">üîµ Normale</option>
                            <option value="4">üü¢ Faible</option>
                        </select>
                    </div>
                </div>
                
                <button type="submit" class="btn btn-success">
                    ‚ú® Ajouter & Tester
                </button>
            </form>
        </div>
    </div>

    <script>
        // Configuration API
        const API_BASE = 'http://localhost:8000'; // Corrig√© pour pointer vers le bon port
        
        // Variables globales
        let constraints = {
            institutional: [],
            user: []
        };

        // Chargement initial
        document.addEventListener('DOMContentLoaded', function() {
            loadConstraints();
        });

        // Fonction principale de chargement
        async function loadConstraints() {
            showStatus('üîÑ Chargement des contraintes...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/list`);
                const data = await response.json();
                
                constraints = data;
                updateStats(data);
                renderInstitutionalConstraints(data.institutional);
                renderUserConstraints(data.user);
                
                showStatus('‚úÖ Contraintes charg√©es avec succ√®s!', 'success');
            } catch (error) {
                console.error('Erreur:', error);
                showStatus('‚ùå Erreur lors du chargement des contraintes', 'error');
                
                // Donn√©es de d√©monstration en cas d'erreur
                loadDemoData();
            }
        }

        // Donn√©es de d√©monstration
        function loadDemoData() {
            const demoData = {
                institutional: [
                    {
                        id: 1,
                        name: 'Horaires d\'ouverture √©cole',
                        type: 'school_hours',
                        priority: 0,
                        is_active: true,
                        description: '√âcole ouverte de 8h √† 18h - NON MODIFIABLE'
                    },
                    {
                        id: 2,
                        name: 'Vendredi √©court√©',
                        type: 'friday_short',
                        priority: 0,
                        is_active: true,
                        description: 'Vendredi se termine √† 13h - NON MODIFIABLE'
                    }
                ],
                user: [],
                total_active: 2
            };
            
            constraints = demoData;
            updateStats(demoData);
            renderInstitutionalConstraints(demoData.institutional);
            renderUserConstraints(demoData.user);
        }

        // Mise √† jour des statistiques
        function updateStats(data) {
            const totalActive = data.total_active || 0;
            const hardCount = [...(data.institutional || []), ...(data.user || [])]
                .filter(c => c.priority === 0 && c.is_active).length;
            
            document.getElementById('totalConstraints').textContent = 
                (data.institutional?.length || 0) + (data.user?.length || 0);
            document.getElementById('activeConstraints').textContent = totalActive;
            document.getElementById('hardConstraints').textContent = hardCount;
            document.getElementById('userConstraints').textContent = data.user?.length || 0;
        }

        // Rendu des contraintes institutionnelles
        function renderInstitutionalConstraints(constraints) {
            const container = document.getElementById('institutionalConstraints');
            
            if (!constraints || constraints.length === 0) {
                container.innerHTML = '<p style="color: #718096;">Aucune contrainte institutionnelle</p>';
                return;
            }
            
            container.innerHTML = constraints.map(c => `
                <div class="constraint-item ${c.is_active ? '' : 'inactive'} ${getPriorityClass(c.priority)}">
                    <div class="constraint-header">
                        <span class="constraint-name">${c.name}</span>
                        <span class="priority-badge priority-${c.priority}">${getPriorityText(c.priority)}</span>
                    </div>
                    <div class="constraint-description">${c.description || c.type}</div>
                    <div class="constraint-controls">
                        <button class="btn btn-small ${c.is_active ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleConstraint('institutional', ${c.id}, ${!c.is_active})">
                            ${c.is_active ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                        </button>
                        ${c.priority > 0 ? `
                        <button class="btn btn-small btn-danger" 
                                onclick="deleteConstraint('institutional', ${c.id})">
                            üóëÔ∏è Supprimer
                        </button>
                        ` : ''}
                    </div>
                </div>
            `).join('');
        }

        // Rendu des contraintes utilisateur
        function renderUserConstraints(constraints) {
            const container = document.getElementById('userConstraintsList');
            
            if (!constraints || constraints.length === 0) {
                container.innerHTML = '<p style="color: #718096;">Aucune contrainte utilisateur</p>';
                return;
            }
            
            container.innerHTML = constraints.map(c => `
                <div class="constraint-item ${c.is_active ? '' : 'inactive'} ${getPriorityClass(c.priority)}">
                    <div class="constraint-header">
                        <span class="constraint-name">${c.constraint_type} - ${c.entity_name}</span>
                        <span class="priority-badge priority-${c.priority}">${getPriorityText(c.priority)}</span>
                    </div>
                    <div class="constraint-description">${JSON.stringify(c.constraint_data)}</div>
                    <div class="constraint-controls">
                        <button class="btn btn-small ${c.is_active ? 'btn-warning' : 'btn-success'}" 
                                onclick="toggleConstraint('user', ${c.constraint_id}, ${!c.is_active})">
                            ${c.is_active ? '‚è∏Ô∏è D√©sactiver' : '‚ñ∂Ô∏è Activer'}
                        </button>
                        <button class="btn btn-small btn-danger" 
                                onclick="deleteConstraint('user', ${c.constraint_id})">
                            üóëÔ∏è Supprimer
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function toggleInputMode() {
            const structured = document.getElementById('structuredInput');
            const isHidden = structured.style.display === 'none';
            structured.style.display = isHidden ? 'block' : 'none';
            
            if (!isHidden) {
                // Reset structured fields
                document.getElementById('entityType').value = '';
                document.getElementById('entityName').value = '';
            }
        }
        // Fonctions utilitaires
        function getPriorityClass(priority) {
            if (priority === 0) return 'hard';
            if (priority === 1) return 'strong';
            if (priority <= 3) return 'medium';
            return '';
        }

        function getPriorityText(priority) {
            const texts = {
                0: 'HARD',
                1: 'FORTE',
                2: 'MOYENNE',
                3: 'NORMALE',
                4: 'FAIBLE',
                5: 'MINIMALE'
            };
            return texts[priority] || 'INCONNUE';
        }

        // Actions
        async function toggleConstraint(type, id, active) {
            showStatus(`üîÑ ${active ? 'Activation' : 'D√©sactivation'} de la contrainte...`, 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/toggle`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: type,
                        id: id,
                        active: active
                    })
                });
                
                if (response.ok) {
                    showStatus(`‚úÖ Contrainte ${active ? 'activ√©e' : 'd√©sactiv√©e'} avec succ√®s!`, 'success');
                    loadConstraints(); // Recharger
                } else {
                    throw new Error('Erreur serveur');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors de la modification', 'error');
            }
        }

        async function deleteConstraint(type, id) {
            if (!confirm('√ätes-vous s√ªr de vouloir supprimer cette contrainte ?')) {
                return;
            }
            
            showStatus('üóëÔ∏è Suppression de la contrainte...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/delete`, {
                    method: 'DELETE',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        type: type,
                        id: id
                    })
                });
                
                if (response.ok) {
                    showStatus('‚úÖ Contrainte supprim√©e avec succ√®s!', 'success');
                    loadConstraints();
                } else {
                    throw new Error('Erreur serveur');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors de la suppression', 'error');
            }
        }

        async function resetAllConstraints() {
            if (!confirm('‚ö†Ô∏è ATTENTION: Cela va supprimer TOUTES les contraintes sauf les critiques. Continuer ?')) {
                return;
            }
            
            showStatus('üßπ Nettoyage en cours...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/reset`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showStatus('‚úÖ Nettoyage termin√©! Seules les contraintes critiques restent.', 'success');
                    loadConstraints();
                } else {
                    throw new Error('Erreur serveur');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors du nettoyage', 'error');
            }
        }

        async function disableAllSoft() {
            showStatus('‚ö†Ô∏è D√©sactivation des contraintes non-critiques...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/disable-soft`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    showStatus('‚úÖ Contraintes non-critiques d√©sactiv√©es!', 'success');
                    loadConstraints();
                } else {
                    throw new Error('Erreur serveur');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors de la d√©sactivation', 'error');
            }
        }

        async function testSolver() {
            showStatus('‚ö° Test du solver en cours...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/solver/test`, {
                    method: 'POST'
                });
                
                const result = await response.json();
                
                if (result.success) {
                    showStatus(`‚úÖ Solver OK! Solution trouv√©e en ${result.time}s`, 'success');
                } else {
                    showStatus(`‚ùå Solver √âCHEC: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors du test du solver', 'error');
            }
        }

        // Formulaire d'ajout
        document.getElementById('constraintForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const formData = {
                text: document.getElementById('constraintText').value,
                type: document.getElementById('constraintType').value,
                entity: document.getElementById('entityName').value,
                priority: parseInt(document.getElementById('priority').value)
            };
            
            if (!formData.text.trim()) {
                showStatus('‚ùå Veuillez saisir une description', 'error');
                return;
            }
            
            showStatus('‚ú® Ajout de la contrainte...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/constraints/add`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(formData)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // V√©rifier si une r√©g√©n√©ration automatique a eu lieu
                    if (result.auto_regenerated) {
                        if (result.regeneration_details && result.regeneration_details.success) {
                            const method = result.regeneration_details.method || 'standard';
                            const qualityScore = result.regeneration_details.quality_score;
                            let statusMessage = `‚úÖ ${result.message || 'Contrainte ajout√©e et emploi du temps r√©g√©n√©r√©!'}`;
                            
                            if (method === 'advanced' && qualityScore) {
                                statusMessage += ` (Score qualit√©: ${Math.round(qualityScore)}%)`;
                            }
                            
                            showStatus(statusMessage, 'success');
                            
                            // Afficher une notification sp√©ciale pour la r√©g√©n√©ration
                            setTimeout(() => {
                                showScheduleUpdateNotification(result.regeneration_details);
                            }, 1000);
                        } else {
                            showStatus('‚ö†Ô∏è Contrainte ajout√©e mais √©chec de la r√©g√©n√©ration automatique', 'warning');
                        }
                    } else {
                        showStatus(result.message || '‚úÖ Contrainte ajout√©e avec succ√®s!', 'success');
                        
                        // Suggestion de r√©g√©n√©ration manuelle
                        setTimeout(() => {
                            showManualRegenerationSuggestion();
                        }, 2000);
                    }
                    
                    document.getElementById('constraintForm').reset();
                    loadConstraints();
                } else {
                    showStatus(`‚ùå Erreur: ${result.error}`, 'error');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors de l\'ajout', 'error');
            }
        });

        // Affichage des messages de statut
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
            
            if (type === 'success' || type === 'warning') {
                setTimeout(() => {
                    statusDiv.innerHTML = '';
                }, type === 'success' ? 3000 : 5000);
            }
        }

        // Notification sp√©ciale pour la mise √† jour de l'emploi du temps
        function showScheduleUpdateNotification(regenerationDetails) {
            const notification = document.createElement('div');
            notification.className = 'schedule-update-notification';
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(45deg, #48bb78, #38a169);
                color: white;
                padding: 20px;
                border-radius: 10px;
                box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
                z-index: 10000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            
            let content = `
                <div style="font-weight: bold; margin-bottom: 8px;">
                    üìÖ Emploi du temps mis √† jour automatiquement !
                </div>
                <div style="font-size: 14px; opacity: 0.9;">
                    M√©thode: ${regenerationDetails.method === 'advanced' ? 'Optimisation avanc√©e' : 'Standard'}
            `;
            
            if (regenerationDetails.quality_score) {
                content += `<br>Score qualit√©: ${Math.round(regenerationDetails.quality_score)}%`;
            }
            
            if (regenerationDetails.schedule_id) {
                content += `<br>ID: ${regenerationDetails.schedule_id}`;
            }
            
            content += `
                </div>
                <div style="margin-top: 10px;">
                    <button onclick="viewUpdatedSchedule()" style="
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                        margin-right: 8px;
                    ">üìä Voir l'emploi du temps</button>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255,255,255,0.1);
                        border: 1px solid rgba(255,255,255,0.2);
                        color: white;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                    ">‚úï</button>
                </div>
            `;
            
            notification.innerHTML = content;
            document.body.appendChild(notification);
            
            // Auto-remove apr√®s 10 secondes
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.remove();
                }
            }, 10000);
        }

        // Suggestion de r√©g√©n√©ration manuelle
        function showManualRegenerationSuggestion() {
            const suggestion = document.createElement('div');
            suggestion.className = 'regeneration-suggestion';
            suggestion.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(45deg, #ed8936, #dd6b20);
                color: white;
                padding: 15px;
                border-radius: 8px;
                box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
                z-index: 9999;
                max-width: 350px;
                animation: slideUp 0.3s ease-out;
            `;
            
            suggestion.innerHTML = `
                <div style="font-weight: bold; margin-bottom: 8px;">
                    üí° Suggestion
                </div>
                <div style="font-size: 14px; margin-bottom: 10px;">
                    Cette contrainte pourrait n√©cessiter une r√©g√©n√©ration de l'emploi du temps
                </div>
                <div>
                    <button onclick="triggerManualRegeneration()" style="
                        background: rgba(255,255,255,0.9);
                        border: none;
                        color: #dd6b20;
                        padding: 8px 16px;
                        border-radius: 4px;
                        cursor: pointer;
                        font-weight: bold;
                        margin-right: 8px;
                    ">üîÑ R√©g√©n√©rer maintenant</button>
                    <button onclick="this.parentElement.parentElement.remove()" style="
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 6px 12px;
                        border-radius: 4px;
                        cursor: pointer;
                    ">Plus tard</button>
                </div>
            `;
            
            document.body.appendChild(suggestion);
            
            // Auto-remove apr√®s 15 secondes
            setTimeout(() => {
                if (suggestion.parentElement) {
                    suggestion.remove();
                }
            }, 15000);
        }

        // Fonction pour voir l'emploi du temps mis √† jour
        function viewUpdatedSchedule() {
            // Ouvrir la page de visualisation dans un nouvel onglet
            window.open('/api/schedule_entries', '_blank');
        }

        // Fonction pour d√©clencher une r√©g√©n√©ration manuelle
        async function triggerManualRegeneration() {
            showStatus('üîÑ R√©g√©n√©ration de l\'emploi du temps en cours...', 'info');
            
            try {
                const response = await fetch(`${API_BASE}/api/advanced/optimize`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                });
                
                const result = await response.json();
                
                if (result.status === 'success') {
                    showStatus(`‚úÖ R√©g√©n√©ration r√©ussie! Score qualit√©: ${Math.round(result.quality_score || 0)}%`, 'success');
                    
                    // Fermer la suggestion
                    document.querySelectorAll('.regeneration-suggestion').forEach(el => el.remove());
                    
                    // Afficher notification de succ√®s
                    setTimeout(() => {
                        showScheduleUpdateNotification({
                            success: true,
                            method: 'advanced',
                            quality_score: result.quality_score,
                            schedule_id: result.schedule_id
                        });
                    }, 1000);
                } else {
                    showStatus('‚ùå √âchec de la r√©g√©n√©ration', 'error');
                }
            } catch (error) {
                showStatus('‚ùå Erreur lors de la r√©g√©n√©ration', 'error');
            }
        }
    </script>
</body>
</html>