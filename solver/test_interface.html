<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Interface - Emploi du Temps</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ccc; }
        .error { color: red; }
        .success { color: green; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
    </style>
</head>
<body>
    <h1>ğŸ§ª Test Interface Emploi du Temps</h1>
    
    <div class="test-section">
        <h2>Test 1: GÃ©nÃ©ration Emploi du Temps</h2>
        <button onclick="testGeneration()">GÃ©nÃ©rer Emploi du Temps Simple</button>
        <div id="generationResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 2: Affichage par Classe</h2>
        <button onclick="testViewByClass()">Voir par Classe (Schedule ID 103)</button>
        <div id="classByResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 3: Affichage par Professeur</h2>
        <button onclick="testViewByTeacher()">Voir par Professeur (Schedule ID 103)</button>
        <div id="teacherByResult"></div>
    </div>

    <div class="test-section">
        <h2>Test 4: Test Encodage HÃ©breu</h2>
        <button onclick="testHebrewEncoding()">Test CaractÃ¨res HÃ©breux</button>
        <div id="hebrewResult"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8000';

        // Test 1: GÃ©nÃ©ration
        async function testGeneration() {
            const result = document.getElementById('generationResult');
            result.innerHTML = '<p>â³ GÃ©nÃ©ration en cours...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/generate_schedule_simple`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ time_limit: 30 })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    result.innerHTML = `
                        <div class="success">
                            âœ… GÃ©nÃ©ration rÃ©ussie!<br>
                            Schedule ID: ${data.schedule_id}<br>
                            QualitÃ©: ${data.quality_score}/100<br>
                            Trous: ${data.gaps_count}<br>
                            Temps: ${data.solve_time.toFixed(2)}s
                        </div>
                    `;
                    window.lastScheduleId = data.schedule_id;
                } else {
                    result.innerHTML = '<div class="error">âŒ Ã‰chec de gÃ©nÃ©ration</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Erreur: ${error.message}</div>`;
            }
        }

        // Test 2: Vue par classe
        async function testViewByClass() {
            const result = document.getElementById('classByResult');
            const scheduleId = window.lastScheduleId || 103;
            
            result.innerHTML = '<p>â³ Chargement vue par classe...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule_by_class/${scheduleId}`);
                const data = await response.json();
                
                if (data.success) {
                    const firstClass = Object.keys(data.classes)[0];
                    const firstClassData = data.classes[firstClass];
                    
                    result.innerHTML = `
                        <div class="success">
                            âœ… Vue par classe rÃ©ussie!<br>
                            Total classes: ${data.total_classes}<br>
                            PremiÃ¨re classe: ${firstClass}<br>
                            Heures: ${firstClassData.stats.total_hours}<br>
                            MatiÃ¨res: ${firstClassData.stats.subjects_count}<br>
                            Professeurs: ${firstClassData.stats.teachers_count}
                        </div>
                        <button onclick="testJSONSafety('classes', ${JSON.stringify(JSON.stringify(data.classes))})">
                            Test SÃ©curitÃ© JSON Classes
                        </button>
                    `;
                } else {
                    result.innerHTML = '<div class="error">âŒ Ã‰chec vue par classe</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Erreur: ${error.message}</div>`;
            }
        }

        // Test 3: Vue par professeur
        async function testViewByTeacher() {
            const result = document.getElementById('teacherByResult');
            const scheduleId = window.lastScheduleId || 103;
            
            result.innerHTML = '<p>â³ Chargement vue par professeur...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/schedule_by_teacher/${scheduleId}`);
                const data = await response.json();
                
                if (data.success) {
                    const firstTeacher = Object.keys(data.teachers)[0];
                    const firstTeacherData = data.teachers[firstTeacher];
                    
                    result.innerHTML = `
                        <div class="success">
                            âœ… Vue par professeur rÃ©ussie!<br>
                            Total professeurs: ${data.total_teachers}<br>
                            Premier professeur: ${firstTeacher}<br>
                            Heures: ${firstTeacherData.stats.total_hours}<br>
                            MatiÃ¨res: ${firstTeacherData.stats.subjects_count}<br>
                            Classes: ${firstTeacherData.stats.classes_count}
                        </div>
                        <button onclick="testJSONSafety('teachers', ${JSON.stringify(JSON.stringify(data.teachers))})">
                            Test SÃ©curitÃ© JSON Professeurs
                        </button>
                    `;
                } else {
                    result.innerHTML = '<div class="error">âŒ Ã‰chec vue par professeur</div>';
                }
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Erreur: ${error.message}</div>`;
            }
        }

        // Test 4: Test hÃ©breu
        function testHebrewEncoding() {
            const result = document.getElementById('hebrewResult');
            
            try {
                // Test avec caractÃ¨res hÃ©breux
                const hebrewData = {
                    "×–-1": {
                        days: {
                            "Dimanche": { hebrew_name: "×¨××©×•×Ÿ" },
                            "Lundi": { hebrew_name: "×©× ×™" },
                            "Mardi": { hebrew_name: "×©×œ×™×©×™" }
                        },
                        subjects: ["×©×™×— ×‘×•×§×¨", "×—×™× ×•×š", "××ª××˜×™×§×”"]
                    }
                };

                // Tester l'encodage sÃ©curisÃ©
                const safeSerialization = JSON.stringify(hebrewData).replace(/</g, '&lt;').replace(/>/g, '&gt;');
                
                // CrÃ©er un Ã©lÃ©ment cachÃ©
                const testDiv = document.createElement('div');
                testDiv.style.display = 'none';
                testDiv.innerHTML = safeSerialization;
                document.body.appendChild(testDiv);
                
                // Tester la dÃ©sÃ©rialisation
                const parsed = JSON.parse(testDiv.textContent);
                
                result.innerHTML = `
                    <div class="success">
                        âœ… Test hÃ©breu rÃ©ussi!<br>
                        Classe: ${Object.keys(parsed)[0]}<br>
                        Jour hÃ©breu: ${parsed["×–-1"].days.Dimanche.hebrew_name}<br>
                        MatiÃ¨re hÃ©breu: ${parsed["×–-1"].subjects[0]}
                    </div>
                `;
                
                // Nettoyer
                document.body.removeChild(testDiv);
                
            } catch (error) {
                result.innerHTML = `<div class="error">âŒ Erreur hÃ©breu: ${error.message}</div>`;
            }
        }

        // Test sÃ©curitÃ© JSON
        function testJSONSafety(type, jsonString) {
            try {
                // CrÃ©er un Ã©lÃ©ment cachÃ© pour tester
                const testDiv = document.createElement('div');
                testDiv.style.display = 'none';
                testDiv.innerHTML = jsonString.replace(/</g, '&lt;').replace(/>/g, '&gt;');
                document.body.appendChild(testDiv);
                
                // Tester la dÃ©sÃ©rialisation
                const parsed = JSON.parse(testDiv.textContent);
                const count = Object.keys(parsed).length;
                
                alert(`âœ… Test sÃ©curitÃ© JSON ${type} rÃ©ussi! ${count} Ã©lÃ©ments parsed sans erreur.`);
                
                // Nettoyer
                document.body.removeChild(testDiv);
                
            } catch (error) {
                alert(`âŒ Test sÃ©curitÃ© JSON ${type} Ã©chouÃ©: ${error.message}`);
            }
        }

        // Initialisation
        window.lastScheduleId = 103; // Schedule par dÃ©faut pour les tests
        
        // Message de dÃ©marrage
        document.addEventListener('DOMContentLoaded', function() {
            console.log('ğŸ§ª Page de test chargÃ©e. Vous pouvez tester les corrections d\'encodage JSON.');
        });
    </script>
</body>
</html>