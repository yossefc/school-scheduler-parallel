# Configuration Prometheus pour School Scheduler AI Agent
global:
  scrape_interval: 15s
  evaluation_interval: 15s
  external_labels:
    monitor: 'school-scheduler-ai'

# Règles d'alerte
rule_files:
  - '/etc/prometheus/alerts/*.yml'

# Configuration des scrapes
scrape_configs:
  # Métriques de l'agent IA
  - job_name: 'ai_agent'
    static_configs:
      - targets: ['ai_agent:5001']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Métriques du solver principal
  - job_name: 'solver'
    static_configs:
      - targets: ['solver:8000']
    metrics_path: '/metrics'
    scrape_interval: 10s

  # Métriques Redis
  - job_name: 'redis'
    static_configs:
      - targets: ['redis:6379']

  # Métriques PostgreSQL (via postgres_exporter si configuré)
  - job_name: 'postgresql'
    static_configs:
      - targets: ['postgres:9187']

  # Métriques Prometheus lui-même
  - job_name: 'prometheus'
    static_configs:
      - targets: ['localhost:9090']

# Configuration des alertes
alerting:
  alertmanagers:
    - static_configs:
        - targets: []  # Configurer si Alertmanager est utilisé

# Métriques personnalisées pour l'agent IA
# Ces métriques sont exposées par l'application Flask
metric_relabel_configs:
  - source_labels: [__name__]
    regex: 'ai_agent_.*'
    target_label: __tmp_ai_metric
    replacement: 'true'